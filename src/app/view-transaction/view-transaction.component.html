<div class="container">

    <div class="row">

        <div class="col-sm-12">

         
            <br>

            <div *ngIf="ofert && person  ;else loading" class="row text-center">

                <div class="col-sm-12">

                    <div class="process">
                        <div class="process-row">
                            <div class="process-step">
                                <button [style.background-color]="getColorStatusNew(ofert.status)" type="button"
                                    class="btn btn-default btn-circle" disabled="disabled"><i
                                        class="fas fa-user fa-2x"></i></button>
                                <p>En espera</p>
                            </div>
                            <div class="process-step">
                                <button [style.background-color]="getColorStatusPending(ofert.status)" type="button"
                                    class="btn btn-default btn-circle" disabled="disabled"><i
                                        class="fas fa-tasks fa-2x"></i></button>
                                <p>Pendiente</p>
                            </div>
                            <div class="process-step" *ngIf="ofert.status!='canceled-and-waiting-for-rating'">
                                <button [style.background-color]="getColorStatusWaiting(ofert.status)" type="button"
                                    class="btn btn-default btn-circle" disabled="disabled"><i
                                        class="fas fa-thumbs-up fa-2x"></i></button>
                                <p>Por calificar</p>
                            </div>
                            <div *ngIf="ofert.status==='canceled-and-waiting-for-rating'" class="process-step">
                                <button type="button" class="btn btn-default btn-circle bg-danger"
                                    disabled="disabled"><i class="fas fa-thumbs-up fa-2x"></i></button>
                                <p>Cancelado</p>
                            </div>


                            <div *ngIf="ofert.status!='canceled-and-finalized' && ofert.status!='canceled-by-owner'"
                                class="process-step">
                                <button [style.background-color]="getColorStatusFinalized(ofert.status)" type="button"
                                    class="btn btn-default btn-circle" disabled="disabled"><i
                                        class="fas fa-check-double fa-2x"></i></button>
                                <p>Finalizado</p>
                            </div>

                            <div *ngIf="ofert.status==='canceled-and-finalized'" class="process-step">
                                <button [style.background-color]="getColorStatusFinalized(ofert.status)" type="button"
                                    class="btn btn-default bg-danger btn-circle" disabled="disabled"><i
                                        class="fas fa-times fa-2x"></i></button>
                                <p>Cancelado</p>
                            </div>

                            <div *ngIf="ofert.status==='canceled-by-owner'" class="process-step">
                                <button type="button" class="btn btn-default btn-circle bg-danger"
                                    disabled="disabled"><i class="fas fa-times fa-2x"></i></button>
                                <p>Cancelado</p>
                            </div>

                        </div>

                    </div>
                    <br>
                </div>

                <div class="col-sm-6">


                    <div *ngIf="ofert.status==='new' || ofert.status==='canceled-by-owner'; else accepted"
                        class="cardbox row text-center">

                        <div class=" col-lg-12 col-xl-6">
                            <img class="avatar img-thumbnail" src={{person.photoUrl}} alt="Card image">
                            <h3 class="text-center"> @{{ person.username }} </h3>
                        </div>

                        <div class="table col-lg-12 col-xl-6">
                            <br>
                            <app-rating></app-rating>


                            <h5>{{ person.name }} </h5>
                            <h6>Tlf: {{ person.phone_number }} </h6>

                            <br>
                            <div mat-raised-button (click)="showRatingPanel()" class="btn btn-primary"><i
                                    class="far fa-eye"></i> Ver panel de
                                reputación</div>
                        </div>

                    </div>

                    <ng-template #accepted>
                        <div class="cardbox row text-center ">

                            <div class=" col-lg-12 col-xl-6">
                                <img class="avatar img-thumbnail" src={{partner.photoUrl}} alt="Card image">
                                <h3 class="text-center"> @{{ partner.username }} </h3>
                            </div>

                            <div class="table col-lg-12 col-xl-6">
                                <br>
                                <app-rating></app-rating>


                                <h5>{{ partner.name }} </h5>
                                <h6>Tlf: {{ partner.phone_number }} </h6>

                                <br>
                                <div mat-raised-button (click)="showRatingPanel()" class="btn btn-primary"><i
                                        class="far fa-eye"></i> Ver panel de reputación</div>

                            </div>

                        </div>
                    </ng-template>

                </div>

                <div class="col-sm-6">
                    <!--left col-->

                    <div class="card bg-light cardbox text-left">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID DE TRANSACCIÓN: {{ ofert.id }}</th>
                                </tr>
                            </thead>
                            <tbody>



                                <tr>
                                    <td>
                                        <div class="">{{ofert.tipo}} {{ ofert.monto + ofert.divisaMonto}}
                                            {{ ofert.origen }}</div> pago por: {{ ofert.destino }} se entrega:
                                        {{ ofert.entrega}}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="">TASA: {{ ofert.tasa }} {{ofert.divisaTasa }}</td>

                                </tr>
                            </tbody>
                        </table>
                    </div>

                </div>

                <div class="option col-sm-12">
                    <!--left col-->
                    <div class="success card bg-light cardbox text-center">
                        <h3 *ngIf="(ofert.status==='pending' || ofert.status==='new') && type==='my-oferts'">¿Desea
                            cancelar la
                            transacción?</h3>

                        <h3 *ngIf="ofert.status==='pending' && type==='accepted-oferts'">¿Se ha completado con éxito la
                            transacción?</h3>

                        <h3 *ngIf="ofert.status==='finalized'"><br>¡Transacción completada con exito!<br><br></h3>
                        <h3 *ngIf="ofert.status==='canceled-and-finalized'"><br>¡Transacción cancelada!<br><br></h3>
                        <h3 *ngIf="ofert.status==='canceled-by-owner'"><br>¡Transacción cancelada!<br><br></h3>
                        <h3 *ngIf="ofert.status==='waiting-for-rating'">¡Transacción completada con exito!, califica a
                            tu compañero</h3>
                        <h3 *ngIf="ofert.status==='canceled-and-wating-for-rating'">¡Transacción cancelada!, califica a
                            tu compañero</h3>

                        <div class="btn-group">
                            <button class="btn btn-danger"
                                *ngIf="(ofert.status==='new' || ofert.status==='pending') && type==='my-oferts'"
                                mat-raised-button (click)="openDialogToCancel()">Cancelar</button>

                            <button class="btn btn-success" *ngIf="ofert.status==='waiting-for-rating'"
                                mat-raised-button (click)="openSuccesful()">Calificar</button>

                            <button class="btn btn-success" *ngIf="ofert.status==='canceled-and-wating-for-rating'"
                                mat-raised-button (click)="openUnsuccesful()">Calificar</button>


                            <button class="btn btn-success" *ngIf="ofert.status==='pending' && type==='accepted-oferts'"
                                mat-raised-button (click)="openDialogSuccess()">SI</button>

                            <button class="btn btn-danger" *ngIf="ofert.status==='pending' && type==='accepted-oferts'"
                                mat-raised-button (click)="openDialogUnsuccess()">NO</button>

                        </div>

                    </div>

                </div>


                <div *ngIf="ofert.status!='new' && ofert.status!='canceled-and-finalized' && ofert.status!='finalized' && ofert.status!='canceled-by-owner' ;else chatOffline"
                    class="col-sm-12 chat">
                    <div class="card chatcard">
                        <div class="card-header msg_head">
                            <div class="d-flex bd-highlight">
                                <div *ngIf="type==='my-oferts'" class="user_info">
                                    <span>Habla con @{{ ofert.acceptedBy }}</span>
                                </div>
                                <div *ngIf="type==='accepted-oferts'" class="user_info">
                                    <span>Habla con @{{ ofert.username }}</span>
                                </div>

                            </div>

                        </div>

                        <div class="card-body msg_card_body">
                       
                                <div *ngFor="let msg of chats">
                                    <div *ngIf="msg.partner===partner.username" class="d-flex justify-content-start mb-4">
                                        <div class="img_cont_msg">
                                            <img src="{{ partner.photoUrl }}" class="rounded-circle user_img_msg">
                                        </div>
                                        <div class="msg_cotainer">
                                            {{ msg.content }}

                                            <span class="msg_time">{{msg.date | date:'medium'}}</span>
                                        </div>
                                    </div>

                                    <div *ngIf="msg.partner===user.username"
                                        class="d-flex justify-content-end mb-4">
                                        <div class="msg_cotainer_send">
                                            {{ msg.content }}

                                            <span class="msg_time"> {{msg.date | date:'medium'}} </span>
                                        </div>
                                        <div class="img_cont_msg">
                                            <img src="{{user.photoUrl}}" class="rounded-circle user_img_msg">
                                        </div>
                                    </div>
                
                            </div>
                        

                        </div>


                        <div class="card-footer ">
                            <div class="input-group">
                                <textarea [(ngModel)]="content" name="" class="form-control type_msg"
                                    placeholder="Type your message..."></textarea>
                                <div class="input-group-append">
                                    <span (click)="sendMessage()" class="input-group-text send_btn"><i
                                            class="fas fa-location-arrow"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <br><br><br><br>
            </div>


        </div>

        <ng-template #loading>

            <app-loading class="text-center"></app-loading>

        </ng-template>

        <ng-template #chatOffline>
            <div *ngIf="ofert.status==='new'" class="container text-left">
                <h6>Chat no disponible hasta que la oferta sea aceptada.</h6>
            </div>
            <div *ngIf="ofert.status!='new'" class="container text-left">
                <h6>Chat no disponible, transacción finalizada.</h6>
            </div>

        </ng-template>